doctrine Invol where {
  mode M;
  type A @M;
  gen f : [A] -> [A] @M;
  rule computational inv -> : [A] -> [A] @M =
    f ; f == id[A]
}

morphism Double : Invol -> Invol where {
  gen f @ M -> f ; f
}

pipeline legacy_main where {
  normalize;
  apply Double;
  extract diagram;
}

run main using legacy_main where {
  source doctrine Invol;
  source mode M;
}
---
f
---
