doctrine D where {
  mode C;
  mode V;

  type A @C;
  type B @V;

  gen f : [A] -> [A] @C;
  gen g : [B] -> [B] @V;
}

morphism CtoV : D -> D where {
  mode C -> V;
  mode V -> V;
  type A @C -> B @V;
  gen f @C -> g
  gen g @V -> g
}

pipeline legacy_main where {
  normalize;
  apply CtoV;
  extract diagram;
}

run main using legacy_main where {
  source doctrine D;
  source mode C;
}
---
f
---
