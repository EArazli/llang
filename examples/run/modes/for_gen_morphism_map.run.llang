doctrine ForGenSchemaMap where {
  mode M;

  type X @M;

  gen op(a@M) : [a] -> [a] @M;

  obligation mapped_op for_gen @M =
    @gen ; lift_cod(op) == @gen ; lift_cod(op)
}

doctrine ForGenTargetMap where {
  mode M;

  type X @M;

  gen discard(a@M) : [a] -> [] @M;
  gen keep(a@M) : [a] -> [a] @M;
  gen op2(a@M) : [a] -> [a] @M;
}

morphism fgMapInst : ForGenSchemaMap -> ForGenTargetMap where {
  mode M -> M;
  gen op @M -> op2
  check none;
}

implements ForGenSchemaMap for ForGenTargetMap using fgMapInst;

pipeline debug where {
  extract diagram;
}

run sanity using debug where {
  source doctrine ForGenTargetMap;
  source mode M;
}
---
discard{M.X}
---
