doctrine FreeIndexMustFail where {
  mode M;
  mode I;
  index_mode I;

  type Nat @I;
  index_fun Z : Nat @I;

  type Vec(n : Nat) @M;

  gen make(n : Nat) : [] -> [Vec(n)] @M;
}

pipeline legacy_main where {
  normalize;
  extract diagram;
}

run main using legacy_main where {
  source doctrine FreeIndexMustFail;
  source mode M;
}
---
make
---
