doctrine ImplicitBinderIndex where {
  mode M;
  mode I;
  index_mode I;

  type Nat @I;
  index_fun Z : Nat @I;

  type Vec(n : Nat) @M;
  type Out @M;

  gen use(n : Nat) : [] -> [Vec(n)] @M;
  gen wrap : [binder { n : Nat } : [Vec(n)]] -> [Out] @M;
}

pipeline legacy_main where {
  normalize;
  extract diagram;
}

run main using legacy_main where {
  source doctrine ImplicitBinderIndex;
  source mode M;
}
---
wrap[use]
---
