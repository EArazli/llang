doctrine ImplicitBinderIndex where {
  mode M;
  mode I;

  type Nat @I;
  gen Z : [] -> [Nat] @I;

  type Vec(n : Nat) @M;
  type Out @M;

  gen use(n : Nat) : [] -> [Vec(n)] @M;
  gen wrap : [binder { tm n : Nat } : [Vec(n)]] -> [Out] @M;
}

pipeline legacy_main where {
  normalize;
  extract diagram;
}

run main using legacy_main where {
  source doctrine ImplicitBinderIndex;
  source mode M;
}
---
wrap[use{n}]
---
